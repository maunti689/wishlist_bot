# Wishlist Bot

Телеграм-бот для ведения персональных и совместных вишлистов: категории, фильтры, напоминания и гибкое разграничение доступа.

## Возможности
- создание личных и общих категорий с кодами доступа (просмотр/редактирование)
- добавление и редактирование элементов (цена, даты, теги, ссылки, фото, местоположение)
- фильтрация по тегам, категориям, стоимости, типам и датам
- уведомления о приближающихся датах и активность участников общих списков
- мультиязычный интерфейс (RU/EN) и переводы для кнопок/меню

## Быстрый старт
1. Установите Python 3.11+ и создайте виртуальное окружение.
2. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```
3. Скопируйте `.env.example` в `.env` и заполните значения токена/настроек.
4. Инициализируйте базу (будет создана автоматически при первом запуске).
5. Запустите бота:
   ```bash
   python main.py
   ```

## Переменные окружения
| Переменная      | Значение по умолчанию                 | Описание |
|-----------------|---------------------------------------|----------|
| `BOT_TOKEN`     | —                                     | **Обязательно.** Токен Telegram-бота от BotFather. |
| `DATABASE_URL`  | `sqlite+aiosqlite:///./wishlist.db`   | URL базы данных (SQLite/aiosqlite по умолчанию). |
| `TIMEZONE`      | `Europe/Moscow`                       | Часовой пояс для формата дат и уведомлений. |
| `LOG_LEVEL`     | `INFO`                                | Уровень логирования (`DEBUG`, `INFO`, `WARNING`, ...). |
| `USE_PID_LOCK`  | `0`                                   | Включить файл-блокировку `bot.pid` (`1`/`true`). |
| `REDIS_URL`     | `redis://localhost:6379/0`            | URL Redis для persistent FSM и rate-limit'ов. |
| `ACCESS_CODE_LENGTH` | `10`                            | Длина генерируемого кода доступа к категории. |
| `ACCESS_CODE_MAX_ATTEMPTS` | `5`                      | Количество неверных попыток перед блокировкой. |
| `ACCESS_CODE_BLOCK_SECONDS` | `900`                   | Длительность блокировки (секунды). |

## Запуск тестов
```bash
pytest
```

## Миграции
Для изменений схемы БД используйте SQL-файлы из каталога `migrations/`. Например, чтобы добавить уникальное ограничение на `shared_categories`, выполните:

```bash
sqlite3 wishlist.db < migrations/001_add_unique_shared_categories.sql
```

Для других СУБД адаптируйте запрос (DDL идентичен).

## Полезно знать
- Runtime-файлы (`.env`, `bot.log`, `wishlist.db`) исключены из Git — не добавляйте их вручную.
- Логи пишутся в stdout, поэтому удобно использовать системный логгер/хостинговый агрегатор.
- Для деплоя можно переопределять `DATABASE_URL` (например, PostgreSQL) и отключать `USE_PID_LOCK` в бездисковых средах.
